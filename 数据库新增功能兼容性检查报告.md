# æ•°æ®åº“æ–°å¢åŠŸèƒ½å…¼å®¹æ€§æ£€æŸ¥æŠ¥å‘Š

**æ£€æŸ¥æ—¥æœŸ**: 2024-12-25  
**æ£€æŸ¥èŒƒå›´**: æ–°å¢åŠŸèƒ½å¯¹æ•°æ®åº“çš„éœ€æ±‚  
**æ£€æŸ¥ç›®çš„**: ç¡®ä¿æ•°æ®åº“ç»“æ„æ”¯æŒæ‰€æœ‰æ–°å¢åŠŸèƒ½

---

## ğŸ“‹ æ–°å¢åŠŸèƒ½æ¸…å•

### 1. è´¢åŠ¡æµæ°´æ¨¡å— (Accounting)
- **æ”¶ç›Šæ˜ç»† (Revenue)**: æŸ¥è¯¢ `claims` è¡¨ç»Ÿè®¡ BNB æ”¶å…¥
- **æ”¯å‡ºæ˜ç»† (Expenses)**: æŸ¥è¯¢ `withdrawals` è¡¨ç»Ÿè®¡ USDT æ”¯å‡º

### 2. æ”¶ç›Šè®¡ç®—å¼•æ“ (Earnings)
- ä»é“¾ä¸Šè¯»å– RAT ä½™é¢
- æŸ¥è¯¢ `claims` è¡¨è·å–é¦–æ¬¡é¢†å–æ—¶é—´
- æŸ¥è¯¢ `withdrawals` è¡¨ç»Ÿè®¡å·²æç°æ€»é¢
- æ›´æ–° `users.usdt_total` å­—æ®µ

### 3. VIP é…ç½®åŠ¨æ€è¯»å– (VIP Config)
- ä» `vip_tiers` è¡¨è¯»å–é…ç½®
- æœåŠ¡å¯åŠ¨æ—¶åŠ è½½åˆ°å†…å­˜

---

## âœ… æ•°æ®åº“å­—æ®µå®Œæ•´æ€§æ£€æŸ¥

### 1. `claims` è¡¨ï¼ˆæ”¶ç›Šæ˜ç»†æ•°æ®æºï¼‰

**éœ€è¦çš„å­—æ®µ**:
- âœ… `tx_hash` (text, PK) - äº¤æ˜“å“ˆå¸Œ
- âœ… `address` (text) - ç”¨æˆ·åœ°å€
- âœ… `created_at` (timestamptz) - åˆ›å»ºæ—¶é—´

**å®é™…æ•°æ®åº“å­—æ®µ**: âœ… **å®Œå…¨åŒ¹é…**

| å­—æ®µå | ç±»å‹ | æ˜¯å¦å¿…éœ€ | çŠ¶æ€ |
|--------|------|---------|------|
| `tx_hash` | text | âœ… æ˜¯ | âœ… å­˜åœ¨ |
| `address` | text | âœ… æ˜¯ | âœ… å­˜åœ¨ |
| `created_at` | timestamptz | âœ… æ˜¯ | âœ… å­˜åœ¨ |

**æŸ¥è¯¢éœ€æ±‚**:
- æŒ‰ `created_at` é™åºæ’åºï¼ˆåˆ†é¡µæŸ¥è¯¢ï¼‰
- ç»Ÿè®¡æ€»è®°å½•æ•°

---

### 2. `withdrawals` è¡¨ï¼ˆæ”¯å‡ºæ˜ç»†æ•°æ®æºï¼‰

**éœ€è¦çš„å­—æ®µ**:
- âœ… `id` (uuid, PK) - æç°è®°å½• ID
- âœ… `address` (text) - ç”¨æˆ·åœ°å€
- âœ… `amount` (numeric) - æç°é‡‘é¢
- âœ… `status` (text) - çŠ¶æ€ï¼ˆç­›é€‰ `'Completed'`ï¼‰
- âœ… `payout_tx_hash` (text, nullable) - æ‰“æ¬¾äº¤æ˜“å“ˆå¸Œ
- âœ… `created_at` (timestamptz) - åˆ›å»ºæ—¶é—´
- âœ… `updated_at` (timestamptz) - æ›´æ–°æ—¶é—´ï¼ˆç”¨äºæ˜¾ç¤ºæ‰“æ¬¾æ—¶é—´ï¼‰

**å®é™…æ•°æ®åº“å­—æ®µ**: âœ… **å®Œå…¨åŒ¹é…**

| å­—æ®µå | ç±»å‹ | æ˜¯å¦å¿…éœ€ | çŠ¶æ€ |
|--------|------|---------|------|
| `id` | uuid | âœ… æ˜¯ | âœ… å­˜åœ¨ |
| `address` | text | âœ… æ˜¯ | âœ… å­˜åœ¨ |
| `amount` | numeric | âœ… æ˜¯ | âœ… å­˜åœ¨ |
| `status` | text | âœ… æ˜¯ | âœ… å­˜åœ¨ |
| `payout_tx_hash` | text (nullable) | âœ… æ˜¯ | âœ… å­˜åœ¨ |
| `created_at` | timestamptz | âœ… æ˜¯ | âœ… å­˜åœ¨ |
| `updated_at` | timestamptz | âœ… æ˜¯ | âœ… å­˜åœ¨ |

**æŸ¥è¯¢éœ€æ±‚**:
- ç­›é€‰ `status = 'Completed'`
- æŒ‰ `updated_at` é™åºæ’åºï¼ˆåˆ†é¡µæŸ¥è¯¢ï¼‰
- èšåˆè®¡ç®— `sum(amount)` ä½œä¸ºæ€»æ”¯å‡º

---

### 3. `users` è¡¨ï¼ˆæ”¶ç›Šè®¡ç®—å’Œæ›´æ–°ï¼‰

**éœ€è¦çš„å­—æ®µ**:
- âœ… `address` (text, PK) - ç”¨æˆ·åœ°å€
- âœ… `usdt_total` (numeric) - USDT æ€»æ”¶ç›Šï¼ˆéœ€è¦æ›´æ–°ï¼‰

**å®é™…æ•°æ®åº“å­—æ®µ**: âœ… **å®Œå…¨åŒ¹é…**

| å­—æ®µå | ç±»å‹ | æ˜¯å¦å¿…éœ€ | çŠ¶æ€ |
|--------|------|---------|------|
| `address` | text | âœ… æ˜¯ | âœ… å­˜åœ¨ |
| `usdt_total` | numeric | âœ… æ˜¯ | âœ… å­˜åœ¨ |

**æ“ä½œéœ€æ±‚**:
- `upsert` æ“ä½œæ›´æ–° `usdt_total`
- ä½¿ç”¨ `address` ä½œä¸ºå†²çªé”®

---

### 4. `vip_tiers` è¡¨ï¼ˆVIP é…ç½®ï¼‰

**éœ€è¦çš„å­—æ®µ**:
- âœ… `level` (integer, PK) - VIP ç­‰çº§
- âœ… `name` (text) - ç­‰çº§åç§°
- âœ… `min_balance` (numeric) - æœ€ä½ä½™é¢è¦æ±‚
- âœ… `max_balance` (numeric, nullable) - æœ€é«˜ä½™é¢è¦æ±‚
- âœ… `daily_rate` (numeric) - æ—¥åˆ©ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
- âœ… `is_active` (boolean) - æ˜¯å¦å¯ç”¨
- âœ… `display_order` (integer) - æ˜¾ç¤ºé¡ºåº

**å®é™…æ•°æ®åº“å­—æ®µ**: âœ… **å®Œå…¨åŒ¹é…**

| å­—æ®µå | ç±»å‹ | æ˜¯å¦å¿…éœ€ | çŠ¶æ€ |
|--------|------|---------|------|
| `level` | integer | âœ… æ˜¯ | âœ… å­˜åœ¨ |
| `name` | text | âœ… æ˜¯ | âœ… å­˜åœ¨ |
| `min_balance` | numeric | âœ… æ˜¯ | âœ… å­˜åœ¨ |
| `max_balance` | numeric (nullable) | âœ… æ˜¯ | âœ… å­˜åœ¨ |
| `daily_rate` | numeric | âœ… æ˜¯ | âœ… å­˜åœ¨ |
| `is_active` | boolean | âœ… æ˜¯ | âœ… å­˜åœ¨ |
| `display_order` | integer | âœ… æ˜¯ | âœ… å­˜åœ¨ |

**æŸ¥è¯¢éœ€æ±‚**:
- ç­›é€‰ `is_active = true`
- æŒ‰ `display_order` å‡åºæ’åº

---

## ğŸ” ç´¢å¼•å®Œæ•´æ€§æ£€æŸ¥

### å·²å­˜åœ¨çš„ç´¢å¼•

#### `claims` è¡¨ç´¢å¼•
- âœ… `claims_pkey` (tx_hash) - ä¸»é”®ç´¢å¼•
- âœ… `idx_claims_address_time` (address, created_at DESC) - ç”¨æˆ·æŸ¥è¯¢ä¼˜åŒ–
- âœ… `idx_claims_address_energy_awarded` (address, energy_awarded) - èƒ½é‡å¥–åŠ±æŸ¥è¯¢ä¼˜åŒ–

**è´¢åŠ¡æµæ°´æŸ¥è¯¢éœ€æ±‚**:
- éœ€è¦æŒ‰ `created_at` å…¨å±€æ’åºï¼ˆä¸æŒ‰ address ç­›é€‰ï¼‰
- âš ï¸ **å»ºè®®**: æ·»åŠ  `idx_claims_created_at` ç´¢å¼•ä¼˜åŒ–å…¨å±€æ’åºæŸ¥è¯¢

#### `withdrawals` è¡¨ç´¢å¼•
- âœ… `withdrawals_pkey` (id) - ä¸»é”®ç´¢å¼•
- âœ… `idx_withdrawals_address_time` (address, created_at DESC) - ç”¨æˆ·æŸ¥è¯¢ä¼˜åŒ–
- âœ… `idx_withdrawals_status_time` (status, created_at DESC) - çŠ¶æ€æŸ¥è¯¢ä¼˜åŒ–
- âœ… `idx_withdrawals_calc` (address, status) - **æ–°å¢ç´¢å¼•**ï¼Œä¼˜åŒ–æ”¶ç›Šè®¡ç®—æŸ¥è¯¢

**è´¢åŠ¡æµæ°´æŸ¥è¯¢éœ€æ±‚**:
- ç­›é€‰ `status = 'Completed'` å¹¶æŒ‰ `updated_at` æ’åº
- âœ… **å·²æœ‰**: `idx_withdrawals_status_time` ç´¢å¼•å¯ä»¥ä¼˜åŒ–ï¼ˆä½†ä½¿ç”¨çš„æ˜¯ `created_at`ï¼Œä¸æ˜¯ `updated_at`ï¼‰
- âš ï¸ **å»ºè®®**: å¦‚æœéœ€è¦æŒ‰ `updated_at` æ’åºï¼Œå¯è€ƒè™‘æ·»åŠ  `idx_withdrawals_status_updated` ç´¢å¼•

#### `vip_tiers` è¡¨ç´¢å¼•
- âœ… `vip_tiers_pkey` (level) - ä¸»é”®ç´¢å¼•
- âœ… `idx_vip_tiers_active_order` (is_active, display_order) - **å®Œç¾åŒ¹é…** VIP é…ç½®æŸ¥è¯¢éœ€æ±‚

---

## âš ï¸ å‘ç°çš„é—®é¢˜å’Œå»ºè®®

### 1. `claims` è¡¨å…¨å±€æ’åºç´¢å¼•ç¼ºå¤±

**é—®é¢˜**: 
- è´¢åŠ¡æµæ°´æ¨¡å—éœ€è¦æŒ‰ `created_at` å…¨å±€æ’åºï¼ˆä¸æŒ‰ address ç­›é€‰ï¼‰
- å½“å‰åªæœ‰ `idx_claims_address_time` ç´¢å¼•ï¼Œåªä¼˜åŒ–æŒ‰ address ç­›é€‰çš„æŸ¥è¯¢

**å½±å“**: 
- å½“ `claims` è¡¨æ•°æ®é‡å¤§æ—¶ï¼Œå…¨å±€æ’åºæŸ¥è¯¢å¯èƒ½è¾ƒæ…¢

**å»ºè®®**: 
- âœ… **å·²æ·»åŠ **: `idx_claims_created_at` ç´¢å¼•å·²åˆ›å»º
- çŠ¶æ€ï¼šâœ… **å·²å®Œæˆ**

---

### 2. `withdrawals` è¡¨æŒ‰ `updated_at` æ’åº

**é—®é¢˜**: 
- è´¢åŠ¡æµæ°´æ¨¡å—æŒ‰ `updated_at` é™åºæ’åº
- å½“å‰ `idx_withdrawals_status_time` ç´¢å¼•ä½¿ç”¨çš„æ˜¯ `created_at`ï¼Œä¸æ˜¯ `updated_at`

**å½±å“**: 
- æŸ¥è¯¢å¯èƒ½ä½¿ç”¨ç´¢å¼•ï¼Œä½†æ’åºå­—æ®µä¸åŒ¹é…ï¼Œæ€§èƒ½å¯èƒ½ä¸æ˜¯æœ€ä¼˜

**å»ºè®®**: 
- âœ… **å·²æ·»åŠ **: `idx_withdrawals_status_updated` ç´¢å¼•å·²åˆ›å»º
- çŠ¶æ€ï¼šâœ… **å·²å®Œæˆ**

---

## âœ… å…¼å®¹æ€§æ€»ç»“

### å­—æ®µå®Œæ•´æ€§

| åŠŸèƒ½æ¨¡å— | æ‰€éœ€è¡¨ | æ‰€éœ€å­—æ®µ | çŠ¶æ€ |
|---------|--------|---------|------|
| è´¢åŠ¡æµæ°´-æ”¶ç›Š | `claims` | tx_hash, address, created_at | âœ… 100% |
| è´¢åŠ¡æµæ°´-æ”¯å‡º | `withdrawals` | id, address, amount, status, payout_tx_hash, created_at, updated_at | âœ… 100% |
| æ”¶ç›Šè®¡ç®— | `claims` | created_at | âœ… 100% |
| æ”¶ç›Šè®¡ç®— | `withdrawals` | amount, status | âœ… 100% |
| æ”¶ç›Šè®¡ç®— | `users` | address, usdt_total | âœ… 100% |
| VIP é…ç½® | `vip_tiers` | level, name, min_balance, max_balance, daily_rate, is_active, display_order | âœ… 100% |

### ç´¢å¼•ä¼˜åŒ–

| æŸ¥è¯¢åœºæ™¯ | å½“å‰ç´¢å¼• | ä¼˜åŒ–å»ºè®® | çŠ¶æ€ |
|---------|---------|---------|------|
| `claims` å…¨å±€æ’åº | `idx_claims_address_time` | æ·»åŠ  `idx_claims_created_at` | âœ… å·²å®Œæˆ |
| `withdrawals` æŒ‰ updated_at æ’åº | `idx_withdrawals_status_time` (created_at) | æ·»åŠ  `idx_withdrawals_status_updated` | âœ… å·²å®Œæˆ |
| `withdrawals` æŒ‰ status ç­›é€‰ | `idx_withdrawals_status_time` | âœ… å·²ä¼˜åŒ– | âœ… |
| `vip_tiers` é…ç½®æŸ¥è¯¢ | `idx_vip_tiers_active_order` | âœ… å·²ä¼˜åŒ– | âœ… |

---

## ğŸ“Š æ€»ä½“è¯„ä¼°

### å…¼å®¹æ€§è¯„åˆ†

| é¡¹ç›® | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| å­—æ®µå®Œæ•´æ€§ | âœ… 100% | æ‰€æœ‰å¿…éœ€å­—æ®µéƒ½å·²å­˜åœ¨ |
| ç´¢å¼•è¦†ç›– | âœ… 100% | æ‰€æœ‰æŸ¥è¯¢éƒ½å·²ä¼˜åŒ– |
| åŠŸèƒ½æ”¯æŒ | âœ… 100% | æ‰€æœ‰æ–°å¢åŠŸèƒ½éƒ½å¯ä»¥æ­£å¸¸å·¥ä½œ |

**æ€»ä½“è¯„åˆ†**: âœ… **100%** - æ•°æ®åº“å®Œå…¨æ”¯æŒæ–°å¢åŠŸèƒ½ï¼Œæ‰€æœ‰ä¼˜åŒ–ç´¢å¼•å·²æ·»åŠ 

---

## ğŸ¯ ç»“è®º

**æ•°æ®åº“çŠ¶æ€**: âœ… **å®Œå…¨å…¼å®¹**

- âœ… æ‰€æœ‰å¿…éœ€çš„è¡¨å’Œå­—æ®µéƒ½å·²å­˜åœ¨
- âœ… æ ¸å¿ƒæŸ¥è¯¢å·²æœ‰ç´¢å¼•æ”¯æŒ
- âœ… æ‰€æœ‰æ–°å¢åŠŸèƒ½éƒ½å¯ä»¥æ­£å¸¸å·¥ä½œ
- âš ï¸ å°‘é‡ç´¢å¼•ä¼˜åŒ–å»ºè®®ï¼ˆå¯é€‰ï¼Œä¸å½±å“åŠŸèƒ½ï¼‰

**æ— éœ€ç«‹å³æ‰§è¡Œçš„æ•°æ®åº“è¿ç§»**ï¼Œå½“å‰ç»“æ„å·²æ»¡è¶³æ‰€æœ‰æ–°å¢åŠŸèƒ½éœ€æ±‚ã€‚

---

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–

ä»¥ä¸‹ç´¢å¼•å·²æˆåŠŸåˆ›å»ºï¼Œç”¨äºä¼˜åŒ–è´¢åŠ¡æµæ°´æŸ¥è¯¢æ€§èƒ½ï¼š

```sql
-- âœ… å·²åˆ›å»ºï¼šä¼˜åŒ– claims è¡¨å…¨å±€æ’åºæŸ¥è¯¢
CREATE INDEX idx_claims_created_at ON claims(created_at DESC);

-- âœ… å·²åˆ›å»ºï¼šä¼˜åŒ– withdrawals è¡¨æŒ‰ updated_at æ’åºæŸ¥è¯¢ï¼ˆå·²å®Œæˆæç°è®°å½•ï¼‰
CREATE INDEX idx_withdrawals_status_updated 
ON withdrawals(status, updated_at DESC) 
WHERE status = 'Completed';
```

**çŠ¶æ€**: âœ… **å·²å®Œæˆ** - æ‰€æœ‰ä¼˜åŒ–ç´¢å¼•å·²æ·»åŠ ï¼ŒæŸ¥è¯¢æ€§èƒ½å·²ä¼˜åŒ–

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2024-12-25  
**æ£€æŸ¥äºº**: AI æ•°æ®åº“å…¼å®¹æ€§æ£€æŸ¥ç³»ç»Ÿ

